<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é–“é•ã„æ¢ã—ï¼ˆã‚¢ãƒ‹ãƒ¡é¢¨ãƒ»é™æ­¢ãƒ»è¶…å¤§ãã„é–“é•ã„ï¼‰</title>
<style>
  :root{
    --bg:#0b1020; --fg:#e6f3ff; --line:#22314f;
    --good:#23d18b; --bad:#ff4d6d; --hint:#f7b500;
  }
  html,body{margin:0;background:radial-gradient(1200px 600px at 50% 5%, #151d3f 0%, #0b1020 55%, #070a14 100%);
    color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif}
  .wrap{max-width:1280px;margin:0 auto;padding:14px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{font-size:clamp(18px,3vw,24px);letter-spacing:.06em;margin:6px 0}
  .btn{appearance:none;border:1px solid var(--line);background:#0e1836;color:var(--fg);
    border-radius:12px;padding:10px 16px;cursor:pointer;font-weight:600}
  .btn:hover{filter:brightness(1.08)}
  .pill{padding:6px 12px;border:1px solid var(--line);border-radius:999px;background:#0e1533;font-variant-numeric:tabular-nums}
  .boards{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
  .board{position:relative;border:1px solid var(--line);border-radius:14px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.45);background:#0a122b}
  canvas{display:block;width:100%;height:auto}
  .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;text-align:center;background:rgba(0,0,0,.45)}
  .card{background:rgba(8,12,28,.85);border:1px solid var(--line);border-radius:16px;padding:22px 20px;max-width:560px}
  footer{opacity:.75;font-size:12px;margin-top:10px;text-align:center}
  .shake{animation:shake .25s ease}
  @keyframes shake{
    0%{transform:translateX(0)} 25%{transform:translateX(-6px)}
    50%{transform:translateX(6px)} 75%{transform:translateX(-4px)} 100%{transform:translateX(0)}
  }
  .reticle{
    position:absolute; pointer-events:none; border:2px solid rgba(255,255,255,.45);
    border-radius:50%; width:56px; height:56px; transform:translate(-50%,-50%);
    box-shadow:0 0 0 2px rgba(0,0,0,.25) inset;
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>é–“é•ã„æ¢ã—ï¼ˆã‚¢ãƒ‹ãƒ¡é¢¨ãƒ»é™æ­¢ãƒ»è¶…å¤§ãã„é–“é•ã„ï¼‰</h1>
    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <button id="startBtn" class="btn">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button id="revealBtn" class="btn">ğŸ‘€ ç­”ãˆã‚’è¦‹ã‚‹</button>
      <span class="pill">æ®‹ã‚Š: <b id="remain">-</b></span>
      <span class="pill">ãƒŸã‚¹: <b id="miss">0</b></span>
      <span class="pill">ã‚¿ã‚¤ãƒ : <b id="time">00:00</b></span>
    </div>
  </header>

  <div class="boards">
    <div class="board">
      <canvas id="canL"></canvas>
    </div>
    <div class="board" id="boardR">
      <canvas id="canR"></canvas>
      <div id="menu" class="overlay">
        <div class="card">
          <h2>éŠã³æ–¹</h2>
          <p>ã‚¹ã‚¿ãƒ¼ãƒˆã§å·¦å³ã«ã€Œã‚¢ãƒ‹ãƒ¡é¢¨ã®é¢¨æ™¯ã€ã‚’è‡ªå‹•æç”»ã€‚å³ã«ã¯<b>å¸¸ã«3ã‹æ‰€</b>ã®<b>è¶…å¤§ãã„é•ã„</b>ã‚’ç½®ãã¾ã™ã€‚ã‚¯ãƒªãƒƒã‚¯ã§æŒ‡å®šï¼</p>
          <p style="opacity:.85">é–‹å§‹ç›´å¾Œ3ç§’ã¯ã€æ­£è§£ä½ç½®ãŒè–„ãç‚¹æ»…ã—ã¦è¦‹ã¤ã‘ã‚„ã™ã„ã§ã™ã€‚60ç§’ or ãƒŸã‚¹6å›ã§è‡ªå‹•çš„ã«ç­”ãˆè¡¨ç¤ºã€‚</p>
          <button id="startBig" class="btn">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        </div>
      </div>
      <div id="ret" class="reticle" style="display:none"></div>
    </div>
  </div>

  <footer>Â© 2025 SpotDiff â€” Anime-style / Static / 3 big differences</footer>
</div>

<script>
(function(){
  const canL=document.getElementById('canL'), canR=document.getElementById('canR');
  const ctxL=canL.getContext('2d'), ctxR=canR.getContext('2d');
  const startBtn=document.getElementById('startBtn'), startBig=document.getElementById('startBig');
  const revealBtn=document.getElementById('revealBtn'), menu=document.getElementById('menu');
  const boardR=document.getElementById('boardR'), ret=document.getElementById('ret');
  const remainEl=document.getElementById('remain'), missEl=document.getElementById('miss'), timeEl=document.getElementById('time');

  const DIFF_COUNT=3, AUTO_REVEAL_TIME=60000, AUTO_REVEAL_MISS=6, NEAR_FACTOR=1.6;

  // ç”»åƒã‚µã‚¤ã‚ºï¼ˆæç”»ãƒ™ãƒ¼ã‚¹ï¼‰ã¯å›ºå®šã«ã—ã¦ã€æ¯å›ãã®ã‚µã‚¤ã‚ºã§ç”Ÿæˆï¼ˆâ€œå‹•ãç„¡ã—â€ï¼‰
  const IMG_W = 1280, IMG_H = 768;

  // çŠ¶æ…‹
  let diffs=[], found=0, missCount=0, revealed=false;
  let timerId=null, tStart=0, autoRevealTimer=null, introPulseUntil=0;

  function fmtTime(ms){const s=Math.floor(ms/1000);return `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;}
  function startTimer(){clearInterval(timerId);tStart=performance.now();timerId=setInterval(()=>timeEl.textContent=fmtTime(performance.now()-tStart),250);
    clearTimeout(autoRevealTimer);autoRevealTimer=setTimeout(()=>revealAnswers(true),AUTO_REVEAL_TIME);}
  function stopTimer(){clearInterval(timerId);clearTimeout(autoRevealTimer);}

  function setupCanvas(canvas, ctx){
    const dpr=Math.min(window.devicePixelRatio||1,2);
    canvas.style.width=Math.min(640, IMG_W)+'px';
    const scale=IMG_W/IMG_H;
    const cssW=canvas.clientWidth||Math.min(640, IMG_W);
    const cssH=Math.round(cssW/scale);
    canvas.style.height=cssH+'px';
    canvas.width=Math.round(IMG_W*dpr);
    canvas.height=Math.round(IMG_H*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    ctx.clearRect(0,0,canvas.width/dpr,canvas.height/dpr);
  }

  // ===== ã‚¢ãƒ‹ãƒ¡é¢¨ã®é¢¨æ™¯ã‚’æãï¼ˆç”»åƒä¸ä½¿ç”¨ãƒ»Canvasã®ã¿ï¼‰ =====
  function drawAnimeScene(ctx){
    const w=IMG_W, h=IMG_H;

    // ç©ºï¼ˆã‚¢ãƒ‹ãƒ¡ç©ºã£ã½ã„2æ®µã‚°ãƒ©ãƒ‡ï¼‰
    let g = ctx.createLinearGradient(0,0,0,h*0.7);
    g.addColorStop(0,'#87b9ff'); g.addColorStop(1,'#c9e6ff');
    ctx.fillStyle=g; ctx.fillRect(0,0,w,h*0.7);

    // åœ°å¹³ç·šã€œè‰åœ°
    g = ctx.createLinearGradient(0,h*0.6,0,h);
    g.addColorStop(0,'#7ddc8a'); g.addColorStop(1,'#41b36c');
    ctx.fillStyle=g; ctx.fillRect(0,h*0.6,w,h*0.4);

    // å±±ä¸¦ã¿ï¼ˆä¸¸ã¿ã‚’å¸¯ã³ãŸç¨œç·šï¼‰
    for(let i=0;i<3;i++){
      const baseY = h*0.62 + i*26;
      ctx.fillStyle = `hsl(${180+i*12}, 45%, ${35+i*6}%)`;
      ctx.beginPath();
      ctx.moveTo(0, baseY);
      for(let x=0;x<=w;x+=40){
        const y = baseY - 60*Math.sin((x/220)+(i*0.6)) - (i*12);
        ctx.lineTo(x, y);
      }
      ctx.lineTo(w, h); ctx.lineTo(0, h); ctx.closePath(); ctx.fill();
    }

    // å¤ªé™½
    ctx.fillStyle = '#ffd36b';
    ctx.beginPath(); ctx.arc(w*0.78, h*0.2, 60, 0, Math.PI*2); ctx.fill();

    // é›²ï¼ˆãƒ•ãƒ©ãƒƒãƒˆå¡—ã‚Šï¼‹è§’ä¸¸ï¼‰
    function cloud(x,y,s){
      ctx.fillStyle='rgba(255,255,255,0.95)';
      roundedRect(x, y, 160*s, 48*s, 24*s, true);
      roundedRect(x+90*s, y-10*s, 130*s, 60*s, 28*s, true);
      roundedRect(x+40*s, y+6*s, 120*s, 38*s, 18*s, true);
    }
    cloud(120, 120, 1.0);
    cloud(420, 80, 1.2);
    cloud(740, 130, 0.9);

    // æ¡œã®æœ¨ã£ã½ã„ï¼ˆã‚¢ãƒ‹ãƒ¡å¡—ã‚Šï¼‰
    function sakura(x,y){
      ctx.fillStyle='#6a3f22'; ctx.fillRect(x-8,y,16,80);
      ctx.fillStyle='#ffbcd3';
      ctx.beginPath(); ctx.arc(x, y, 46, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(x+26, y+18, 34, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(x-28, y+10, 30, 0, Math.PI*2); ctx.fill();
    }
    sakura(180, h*0.6-20); sakura(280, h*0.6-10);

    // é³¥ï¼ˆè¨˜å·çš„ï¼‰
    ctx.strokeStyle='#274060'; ctx.lineWidth=3;
    for(let i=0;i<5;i++){
      const bx = 160 + i*120, by = 140 + (i%2)*16;
      ctx.beginPath(); ctx.moveTo(bx,by); ctx.quadraticCurveTo(bx+16,by-10, bx+32,by);
      ctx.moveTo(bx+32,by); ctx.quadraticCurveTo(bx+48,by-10, bx+64,by);
      ctx.stroke();
    }

    function roundedRect(x,y,w,h,r,fill){
      const rr=Math.min(r,w/2,h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr,y);
      ctx.arcTo(x+w,y,x+w,y+h,rr);
      ctx.arcTo(x+w,y+h,x,y+h,rr);
      ctx.arcTo(x,y+h,x,y,rr);
      ctx.arcTo(x,y,x+w,y,rr);
      fill?ctx.fill():ctx.stroke();
    }
  }

  // å³å´ã ã‘ã«ã€Œè¶…å¤§ãã„é•ã„ã€ã‚’é…ç½®ï¼ˆ3ã¤ï¼‰
  function placeBigDifferences(ctx){
    const w=IMG_W, h=IMG_H;
    diffs = [];
    const RMIN=110, RMAX=160, MARGIN=160; // â˜…ç‰¹å¤§ã‚µã‚¤ã‚º
    const shapes = ['star','heart','sunburst']; // ã‚¢ãƒ‹ãƒ¡ã£ã½ã„è¨˜å·

    for(let i=0;i<DIFF_COUNT;i++){
      const r = Math.floor(RMIN + Math.random()*(RMAX-RMIN));
      const x = Math.floor(MARGIN + Math.random()*(w - MARGIN*2));
      const y = Math.floor(MARGIN + Math.random()*(h - MARGIN*2));
      const shape = shapes[i % shapes.length];
      diffs.push({x,y,r,found:false,shape});
      drawMarkerShape(ctx, shape, x, y, r); // å³ã ã‘ä¸Šæãã§â€œé•ã„â€ã‚’ä½œã‚‹
    }

    // é–‹å§‹3ç§’ã ã‘è–„ãç‚¹æ»…ãƒ’ãƒ³ãƒˆ
    introPulseUntil = performance.now() + 3000;
  }

  // å·®åˆ†æœ¬ä½“ï¼ˆå³ã«æãâ€œç›®ç«‹ã¤ã‘ã©ä¸–ç•Œè¦³ãªã˜ã‚€â€å¤§ããªå½¢ï¼‰
  function drawMarkerShape(ctx, shape, x, y, r){
    ctx.save();
    ctx.translate(x,y);
    if(shape==='star'){
      ctx.fillStyle='rgba(255,233,95,0.85)';
      star(0,0,r*0.9, Math.max(6, Math.floor(8)), 0.45);
      ctx.fill();
      ctx.strokeStyle='rgba(0,0,0,.25)'; ctx.lineWidth=4; ctx.stroke();
    }else if(shape==='heart'){
      ctx.fillStyle='rgba(255,120,145,0.85)';
      ctx.beginPath();
      heartPath(0,0,r*0.75); ctx.fill();
      ctx.strokeStyle='rgba(0,0,0,.25)'; ctx.lineWidth=4; ctx.stroke();
    }else{ // sunburst
      ctx.fillStyle='rgba(114,207,255,0.85)';
      sunburst(0,0,r*0.85,10);
      ctx.fill();
      ctx.strokeStyle='rgba(0,0,0,.25)'; ctx.lineWidth=4; ctx.stroke();
    }
    ctx.restore();

    function star(cx,cy,R,points,inner=0.5){
      ctx.beginPath();
      for(let i=0;i<points*2;i++){
        const ang = Math.PI*i/points;
        const rr = (i%2===0)?R:(R*inner);
        const px = cx + rr*Math.cos(ang), py = cy + rr*Math.sin(ang);
        (i===0)?ctx.moveTo(px,py):ctx.lineTo(px,py);
      }
      ctx.closePath();
    }
    function heartPath(cx,cy,sz){
      const s = sz/16;
      ctx.moveTo(cx, cy+6*s);
      ctx.bezierCurveTo(cx-16*s, cy-10*s, cx-10*s, cy-26*s, cx, cy-18*s);
      ctx.bezierCurveTo(cx+10*s, cy-26*s, cx+16*s, cy-10*s, cx, cy+6*s);
    }
    function sunburst(cx,cy,R,n){
      ctx.beginPath();
      for(let i=0;i<n;i++){
        const ang = (i/n)*Math.PI*2;
        const rx = Math.cos(ang), ry = Math.sin(ang);
        ctx.moveTo(cx,cy);
        ctx.lineTo(cx+rx*R, cy+ry*R);
        ctx.arc(cx,cy,R, ang, ang + (Math.PI*2/n));
      }
      ctx.closePath();
    }
  }

  // æ ãƒ»ã‚¬ã‚¤ãƒ‰
  function hintRings(ctx){
    if(performance.now() >= introPulseUntil || revealed) return;
    const a=0.18+0.12*Math.sin(performance.now()/160);
    ctx.save(); ctx.globalAlpha=a; ctx.lineWidth=8; ctx.strokeStyle='var(--hint)';
    diffs.forEach(d=>{ if(!d.found){ ctx.beginPath(); ctx.arc(d.x,d.y,d.r+18,0,Math.PI*2); ctx.stroke(); } });
    ctx.restore();
  }

  // è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
  function pulseRing(ctx,x,y,r,color){
    ctx.save();
    ctx.lineWidth=10; ctx.strokeStyle=color;
    ctx.beginPath(); ctx.arc(x,y,r+20,0,Math.PI*2); ctx.stroke();
    ctx.restore();
  }
  function bigCross(ctx,x,y,size,color){
    const s=size;
    ctx.save();
    ctx.lineWidth=9; ctx.strokeStyle=color; ctx.globalAlpha=.95;
    ctx.beginPath(); ctx.moveTo(x-s,y-s); ctx.lineTo(x+s,y+s);
    ctx.moveTo(x+s,y-s); ctx.lineTo(x-s,y+s); ctx.stroke();
    ctx.restore();
  }
  function nearRing(ctx,x,y,r){
    ctx.save();
    ctx.lineWidth=8; ctx.setLineDash([14,12]); ctx.strokeStyle='var(--hint)';
    ctx.beginPath(); ctx.arc(x,y,r*NEAR_FACTOR,0,Math.PI*2); ctx.stroke();
    ctx.setLineDash([]); ctx.restore();
  }

  function revealAnswers(auto=false){
    stopTimer(); revealed=true;
    // æœªç™ºè¦‹ã‚’ã™ã¹ã¦å¼·èª¿
    ctxR.save(); ctxR.lineWidth=10; ctxR.strokeStyle='var(--hint)'; ctxR.globalAlpha=.95;
    diffs.forEach(d=>{ if(!d.found){ ctxR.beginPath(); ctxR.arc(d.x,d.y,d.r+22,0,Math.PI*2); ctxR.stroke(); } });
    ctxR.restore();
    remainEl.textContent=0;
    setTimeout(()=>alert(auto?'æ™‚é–“/ãƒŸã‚¹ä¸Šé™ã§ç­”ãˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸã€‚ã‚¹ã‚¿ãƒ¼ãƒˆã§å†æŒ‘æˆ¦ã§ãã¾ã™ã€‚':'ç­”ãˆã‚’è¡¨ç¤ºã—ã¾ã—ãŸã€‚ã‚¹ã‚¿ãƒ¼ãƒˆã§å†æŒ‘æˆ¦ã§ãã¾ã™ã€‚'),10);
  }

  function drawBoth(){
    // å·¦å³ã¨ã‚‚åŒã˜â€œã‚¢ãƒ‹ãƒ¡é¢¨é¢¨æ™¯â€
    drawAnimeScene(ctxL);
    drawAnimeScene(ctxR);
  }

  async function startGame(){
    menu.style.display='none';
    revealed=false; remainEl.textContent='-'; timeEl.textContent='00:00'; missEl.textContent='0';
    stopTimer();

    // ã‚­ãƒ£ãƒ³ãƒã‚¹åˆæœŸåŒ–
    setupCanvas(canL, ctxL);
    setupCanvas(canR, ctxR);

    // ãƒ™ãƒ¼ã‚¹æç”»
    drawBoth();

    // å³ã ã‘ã«å¤§ãã„å·®åˆ†ã‚’ç½®ã
    placeBigDifferences(ctxR);

    // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
    found=0; missCount=0;
    remainEl.textContent=(DIFF_COUNT-found);
    startTimer();

    // é–‹å§‹ç›´å¾Œãƒ’ãƒ³ãƒˆã®è–„ãƒªãƒ³ã‚°
    hintRings(ctxR);
  }

  function checkHit(px,py){
    // ã‚­ãƒ£ãƒ³ãƒã‚¹ã® CSSâ†’å®Ÿåº§æ¨™å¤‰æ›ï¼ˆé™æ­¢ãªã®ã§å˜ç´”ï¼‰
    const r=canR.getBoundingClientRect();
    const dpr=Math.min(window.devicePixelRatio||1,2);
    const scaleX=(canR.width/dpr)/r.width, scaleY=(canR.height/dpr)/r.height;
    const x=(px - r.left)*scaleX, y=(py - r.top)*scaleY;

    for(const d of diffs){
      const dist=Math.hypot(x-d.x, y-d.y);
      if(!d.found && dist<=d.r){
        d.found=true; found++;
        pulseRing(ctxR,d.x,d.y,d.r,'var(--good)');
        remainEl.textContent=(DIFF_COUNT-found);
        if(found===DIFF_COUNT){ stopTimer(); setTimeout(()=>alert('ã‚¯ãƒªã‚¢ï¼'),10); }
        return;
      }
      if(!d.found && dist<=d.r*NEAR_FACTOR){
        nearRing(ctxR,d.x,d.y,d.r);
        return;
      }
    }
    // é ã„ï¼ãƒŸã‚¹
    missCount++; missEl.textContent=missCount;
    bigCross(ctxR,x,y,34,'var(--bad)');
    boardR.classList.remove('shake'); void boardR.offsetWidth; boardR.classList.add('shake');
    if(missCount>=AUTO_REVEAL_MISS){ revealAnswers(true); }
  }

  // ã‚¤ãƒ™ãƒ³ãƒˆ
  canR.addEventListener('click', e=>checkHit(e.clientX,e.clientY), {passive:true});

  // ç…§æº–ã‚¬ã‚¤ãƒ‰ï¼ˆä»»æ„ï¼‰ï¼šãƒã‚¦ã‚¹ä½ç½®è¡¨ç¤º
  function moveReticle(e){
    const r=canR.getBoundingClientRect();
    const cx=(e.touches?e.touches[0].clientX:e.clientX);
    const cy=(e.touches?e.touches[0].clientY:e.clientY);
    if(cx<r.left||cx>r.right||cy<r.top||cy>r.bottom){ ret.style.display='none'; return; }
    ret.style.display='block';
    ret.style.left=(cx-r.left)+'px'; ret.style.top=(cy-r.top)+'px';
  }
  canR.addEventListener('mousemove',moveReticle,{passive:true});
  canR.addEventListener('mouseleave',()=>{ ret.style.display='none'; });
  canR.addEventListener('touchstart',moveReticle,{passive:true});
  canR.addEventListener('touchmove',moveReticle,{passive:true});

  // ãƒœã‚¿ãƒ³
  document.getElementById('startBtn').onclick=startGame;
  document.getElementById('revealBtn').onclick=()=>revealAnswers(false);
  document.getElementById('startBig').onclick=startGame;

  // åˆæœŸã‚¬ã‚¤ãƒ‰
  menu.style.display='flex';
})();
</script>
</body>
</html>
