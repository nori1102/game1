<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>間違い探しゲーム</title>
<style>
  :root{ --bg:#0b1020; --fg:#e6f3ff; --good:#2ecc71; --bad:#ff4d6d; --hint:#f39c12; }
  html,body{margin:0;background:#0b1020;color:var(--fg);font-family:sans-serif}
  .wrap{max-width:1000px;margin:0 auto;padding:12px}
  h1{font-size:20px;text-align:center}
  canvas{display:block;margin:10px auto;border:2px solid #345;border-radius:12px;background:#111}
  .hud{display:flex;gap:10px;justify-content:center;margin:10px 0}
  button{padding:8px 14px;border-radius:8px;border:1px solid #345;background:#223;color:#fff;cursor:pointer}
  button:hover{background:#334}
</style>
</head>
<body>
<div class="wrap">
  <h1>間違い探しゲーム</h1>
  <div class="hud">
    <button id="startBtn">▶ スタート</button>
    <button id="hintBtn">💡 ヒント</button>
    <button id="retryBtn">↻ やり直し</button>
  </div>
  <canvas id="game" width="900" height="450"></canvas>
  <p style="text-align:center">左右の絵を見比べて、違うところをクリック！</p>
</div>
<script>
(function(){
  const canvas=document.getElementById('game');
  const ctx=canvas.getContext('2d');
  const W=canvas.width, H=canvas.height;
  const LEFT={x:20,y:20,w:W/2-40,h:H-40};
  const RIGHT={x:W/2+20,y:20,w:W/2-40,h:H-40};
  let differences=[], found=0, level=1;

  function drawScene(x,y,w,h,seed){
    ctx.fillStyle="#0a122b";ctx.fillRect(x,y,w,h);
    for(let i=0;i<5;i++){
      ctx.fillStyle=`hsl(${seed*30+i*40},70%,50%)`;
      ctx.beginPath();
      ctx.arc(x+50+Math.random()*(w-100),y+50+Math.random()*(h-100),20+Math.random()*30,0,Math.PI*2);
      ctx.fill();
    }
  }
  function createLevel(){
    ctx.clearRect(0,0,W,H);
    drawScene(LEFT.x,LEFT.y,LEFT.w,LEFT.h,level);
    drawScene(RIGHT.x,RIGHT.y,RIGHT.w,RIGHT.h,level);
    differences=[];
    for(let i=0;i<3+level;i++){
      const r=15+Math.random()*20;
      const cx=RIGHT.x+40+Math.random()*(RIGHT.w-80);
      const cy=RIGHT.y+40+Math.random()*(RIGHT.h-80);
      differences.push({x:cx,y:cy,r:r,found:false});
      ctx.fillStyle="rgba(255,0,0,0.5)";
      ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2);ctx.fill();
    }
    found=0;
  }
  function check(px,py){
    for(const d of differences){
      if(!d.found){
        const dx=px-d.x, dy=py-d.y;
        if(dx*dx+dy*dy<=d.r*d.r){
          d.found=true;found++;
          ctx.strokeStyle= "#2ecc71";ctx.lineWidth=4;
          ctx.beginPath();ctx.arc(d.x,d.y,d.r+5,0,Math.PI*2);ctx.stroke();
          if(found===differences.length) alert("クリア！次のレベルへ");
          return;
        }
      }
    }
    ctx.strokeStyle="#ff4d6d";ctx.lineWidth=3;
    ctx.beginPath();ctx.arc(px,py,12,0,Math.PI*2);ctx.stroke();
  }
  canvas.addEventListener('click',e=>{
    const r=canvas.getBoundingClientRect();
    const x=e.clientX-r.left, y=e.clientY-r.top;
    check(x,y);
  });
  document.getElementById('startBtn').onclick=()=>{createLevel();};
  document.getElementById('retryBtn').onclick=()=>{createLevel();};
  document.getElementById('hintBtn').onclick=()=>{
    const d=differences.find(d=>!d.found);
    if(d){ctx.strokeStyle="#f39c12";ctx.lineWidth=4;
          ctx.beginPath();ctx.arc(d.x,d.y,d.r+8,0,Math.PI*2);ctx.stroke();}
  };
})();
</script>
</body>
</html>
